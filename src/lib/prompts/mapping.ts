export const lifeAreas = [
  { id: "money", nameHe: "כסף ופיננסים", color: "#918df6" },
  { id: "career", nameHe: "קריירה ועבודה", color: "#7c9df6" },
  { id: "relationships", nameHe: "זוגיות ואהבה", color: "#f67c8d" },
  { id: "family", nameHe: "משפחה", color: "#f6a87c" },
  { id: "fitness", nameHe: "בריאות וכושר", color: "#7cf6a8" },
  { id: "social", nameHe: "חיי חברה", color: "#f6e87c" },
  { id: "confidence", nameHe: "ביטחון עצמי", color: "#b57cf6" },
] as const;

interface QuestionnairePart {
  title: string;
  description?: string;
  questions: string[];
}

interface AreaQuestionnaire {
  part1: QuestionnairePart;
  part2: QuestionnairePart;
  part3: QuestionnairePart;
  part4: QuestionnairePart;
}

const areaQuestionnaires: Record<string, AreaQuestionnaire> = {
  money: {
    part1: {
      title: 'שאלות "השלמת משפטים" (עוקף מודע)',
      description: 'אלו שאלות שצריך לענות עליהן מהר, בלי לחשוב. הן חושפות את ה"תכנה" האוטומטית במוח.',
      questions: [
        '"אנשים שיש להם המון כסף הם בדרך כלל..."',
        '"כדי להיות עשיר באמת במציאות של היום, אדם חייב ל..."',
        '"כסף עבורי הוא בעיקר..."',
      ],
    },
    part2: {
      title: 'חקירת ה"תקרת זכוכית" (יכולת וראויות)',
      description: 'שאלות שנועדו למצוא איפה האדם עוצר את עצמו.',
      questions: [
        '"מהו הסכום החודשי שמעבר לו אתה מרגיש שזה \'יותר מדי\' או \'לא בשבילך\'?"',
        '"אם מחר בבוקר תרוויח פי 10 מהיום – מה הדבר הראשון שממנו אתה מפחד שיקרה (במשפחה, בחברים, בבריאות)?"',
        '"כשאתה עומד לבקש סכום כסף גבוה שמגיע לך (העלאה או מחיר על שירות), איזה קול פנימי עולה? מה הוא אומר?"',
      ],
    },
    part3: {
      title: 'חקירת העבר (מקור האמונה)',
      description: 'ב-NLP אנחנו מחפשים את ה"מודלינג" – ממי למדנו את האמונה.',
      questions: [
        '"איזה משפט על כסף שמעת הכי הרבה בבית כשהיית ילד?"',
        '"מי האדם הראשון שאתה חושב עליו כשאתה חושב על \'עושר\', ומה הרגש הראשון שעולה בך כלפיו?"',
      ],
    },
    part4: {
      title: 'שאלות ה"רווח המשני" (למה אני נשאר עני)',
      description: 'השאלות הכי חשובות לחשיפת המנגנון המגן.',
      questions: [
        '"אם תישאר בדיוק במצב הכלכלי שאתה נמצא בו היום למשך שארית חייך – מאיזה \'כאב ראש\' או אחריות זה יחסוך ממך?"',
        '"מי מהאנשים הקרובים אליך עלול להרגיש מאוים או \'להתרחק\' ממך אם תהיה עשיר מאוד?"',
      ],
    },
  },
  career: {
    part1: {
      title: 'שאלות "השלמת משפטים" (זהות ומקצועיות)',
      questions: [
        '"כדי להגיע לדרג הבכיר ביותר בתחום שלי, אדם צריך להיות מוכן ל..."',
        '"אנשים שהצליחו \'בענק\' בקריירה שלהם הם בדרך כלל אנשים ש..."',
        '"אם הייתי באמת מאמין בעצמי ב-100%, הדבר הראשון שהייתי עושה מחר בבוקר בעבודה זה..."',
      ],
    },
    part2: {
      title: 'חקירת המחסום (יכולת וסביבה)',
      questions: [
        '"מהו התפקיד או הפרויקט שאתה הכי רוצה, אבל אומר לעצמך \'אני עדיין לא מספיק בשל/מנוסה בשבילו\'?"',
        '"כשאתה רואה מישהו פחות מקצועי ממך מקבל קידום או הכרה, מהו ההסבר האוטומטי שאתה נותן לעצמך בראש למה זה קרה לו ולא לך?"',
        '"איזה \'חוק לא כתוב\' בתעשייה שלך אתה מרגיש שמונע ממך להתקדם?"',
      ],
    },
    part3: {
      title: 'חקירת הפחדים (מחיר ההצלחה)',
      questions: [
        '"נניח שקיבלת את תפקיד חלומותיך מחר. מהו הדבר בחיים האישיים שלך (זמן, משפחה, שקט נפשי) שאתה הכי מפחד שיפגע בגלל זה?"',
        '"אם תהפוך לאדם הכי מצליח ומוכר בתחום שלך, מה הקרובים אליך יגידו עליך מאחורי הגב?"',
      ],
    },
    part4: {
      title: 'שאלות "הרווח המשני" (למה להישאר במקום)',
      questions: [
        '"איזה \'חופש\' או \'חוסר אחריות\' יילקחו ממך אם תהיה המנהל או הסמכות הגבוהה ביותר בחדר?"',
        '"מה הדבר שהכי מפחיד אותך לגלות על עצמך אם תנסה בכל הכוח להצליח בקריירה ובסוף זה לא יילך?"',
      ],
    },
  },
  relationships: {
    part1: {
      title: 'שאלות "השלמת משפטים" (תפיסת עולם)',
      questions: [
        '"בסופו של דבר, במערכות יחסים ארוכות טווח, תמיד קורה ש..."',
        '"כדי שקשר יצליח באמת, אדם חייב לוותר על ה..."',
        '"גברים/נשים היום מחפשים רק..."',
      ],
    },
    part2: {
      title: 'חקירת ה"ראויות" (ערך עצמי)',
      questions: [
        '"כשמישהו מראה בך עניין אמיתי ואוהב, מהו ה\'קול\' הקטן בראש שמתחיל לחפש מה לא בסדר אצלו או אצלך?"',
        '"מהו הדבר שאתה הכי מסתיר בתחילת קשר כי אתה בטוח שאם הצד השני יגלה אותו – הוא ילך?"',
        '"האם אתה מרגיש שאתה צריך \'לעבוד קשה\' כדי שיאהבו אותך, או שאהבה זה משהו שמגיע לך פשוט כי אתה קיים?"',
      ],
    },
    part3: {
      title: 'חקירת ה"מגנט" (דפוסים חוזרים)',
      questions: [
        '"אם נסתכל על הקשרים האחרונים שלך – מהו ה\'טיפוס\' שאתה תמיד נמשך אליו למרות שאתה יודע שזה ייגמר בכאב?"',
        '"מהו המשפט שהכי פחדת לשמוע מהאקסים שלך, והאם אתה עדיין שומע אותו בראש היום?"',
      ],
    },
    part4: {
      title: 'שאלות "הרווח המשני" (למה להישאר לבד)',
      questions: [
        '"איזה חופש מוחלט יש לך עכשיו כשאתה לבד (או לא בקשר עמוק), שאתה מפחד שייעלם ברגע שתהיה בזוגיות מחייבת?"',
        '"אם מחר תמצא את \'האחד/ת\' ותהיה מאושר עד הגג – מי מהחברים או המשפחה שלך ירגיש פתאום \'מאחור\' או פחות רלוונטי עבורך?"',
      ],
    },
  },
  family: {
    part1: {
      title: 'שאלות "השלמת משפטים" (נאמנות שבטית)',
      questions: [
        '"במשפחה שלנו, הדבר הכי חשוב שתמיד הקפדנו עליו הוא..."',
        '"כדי להיות בן/בת משפחה \'טובים\', אני חייב תמיד ל..."',
        '"אם אבחר לחיות בדרך שונה לגמרי מההורים שלי, זה ירגיש כאילו אני..."',
      ],
    },
    part2: {
      title: 'חקירת ה"תפקיד" (זהות בתוך מערכת)',
      questions: [
        '"מהו התפקיד שתמיד \'הלבישו\' עליך בבית? (למשל: הילד הבעייתי, הילד המוצלח, זה שדואג לכולם, המתווך)."',
        '"כשאתה חושב על האנשים הכי קרובים אליך, מי האדם שאתה מרגיש שאתה \'חייב\' לו את ההצלחה שלך או את האושר שלך?"',
        '"איזו תכונה של אחד ההורים שלך נשבעת שלעולם לא תהיה לך, ובכל זאת אתה תופס את עצמך מתנהג בדיוק ככה לפעמים?"',
      ],
    },
    part3: {
      title: 'חקירת גבולות ומרחב (חופש מול שייכות)',
      questions: [
        '"מהו הדבר שאתה הכי רוצה לעשות, אבל עוצר את עצמך כי \'זה פשוט לא נהוג אצלנו\'?"',
        '"איזו ביקורת מהמשפחה שלך הכי מפחידה אותך, גם אם היא נאמרת בצחוק או ברמיזה?"',
      ],
    },
    part4: {
      title: 'שאלות "הרווח המשני" (למה להישאר בתפקיד הישן)',
      questions: [
        '"אם תפסיק לנסות לתקן/להציל/לרצות את המשפחה שלך – איזה חלל ריק ייווצר בחיים שלך? עם מה תצטרך להתמודד?"',
        '"מה יקרה למערכת היחסים שלך עם ההורים או האחים אם פתאום תהיה באמת חופשי מהציפיות שלהם?"',
      ],
    },
  },
  fitness: {
    part1: {
      title: 'שאלות "השלמת משפטים" (זהות ומאמץ)',
      questions: [
        '"אנשים שמתאמנים כל יום ואוכלים רק בריא הם בדרך כלל..."',
        '"בשבילי, לעשות אימון גופני מרגיש כמו..."',
        '"כדי שבאמת יהיה לי גוף חזק וחטוב, אני אצטרך להקריב את ה..."',
      ],
    },
    part2: {
      title: 'חקירת ה"מסוגלות" (דימוי עצמי)',
      questions: [
        '"כשאתה רואה את עצמך בראי בבגדי ספורט, איזה משפט אוטומטי עולה לך בראש? (זה הקול של האמונה המגבילה)."',
        '"מהו הספורט או הפעילות שתמיד רצית לנסות אבל אמרת לעצמך \'זה לא לאנשים כמוני\' או \'אני אעשה פדיחות\'?"',
        '"איזה \'כישלון\' מהעבר בתחום הכושר (למשל: מנוי למכון שלא ניצלת) עדיין גורם לך להאמין ש\'אין לי משמעת עצמית\'?"',
      ],
    },
    part3: {
      title: 'חקירת ה"חוקים" (פרדיגמות של \'הכל או כלום\')',
      questions: [
        '"מהו ה\'חוק\' שקבעת לעצמך לגבי אימונים? (למשל: \'אם זה לא שעה של זיעה זה לא נחשב\', \'אם אכלתי פיצה אז כבר הרסתי את כל השבוע\')."',
        '"מי הדמות מהעבר (מורה לספורט, הורה, חבר) שגרמה לך להאמין שאתה לא טיפוס ספורטיבי?"',
      ],
    },
    part4: {
      title: 'שאלות "הרווח המשני" (למה להישאר על הספה)',
      questions: [
        '"אם תהיה בכושר שיא ותיראה מדהים – מאיזו \'ציפייה\' של אנשים ממך אתה מפחד? (למשל: \'פתאום יצפו ממני להרבה יותר בכל תחום\')."',
        '"איך המצב הנוכחי (חוסר כושר/משקל עודף) משמש לך כ\'תירוץ\' למה לא לנסות דברים אחרים בחיים (כמו דייטים או קידום)?"',
      ],
    },
  },
  social: {
    part1: {
      title: 'שאלות "השלמת משפטים" (חוקי הקבוצה)',
      questions: [
        '"כדי להיות האדם הכי פופולרי בחדר, צריך להיות..."',
        '"בדרך כלל, כשאני מגיע לקבוצה של אנשים שאני לא מכיר, אני מרגיש ש..."',
        '"אנשים שהם \'חיות חברתיות\' הם בדרך כלל..."',
      ],
    },
    part2: {
      title: 'חקירת ה"שיפוטיות" (קריאת מחשבות)',
      questions: [
        '"מהו הדבר שאתה הכי מפחד שאנשים יחשבו עליך חמש דקות אחרי שהם פגשו אותך?"',
        '"כשאתה בתוך שיחה ונוצרת שתיקה מביכה – מהו המשפט הראשון שעובר לך בראש? (למשל: \'אני משעמם\', \'זה באשמתי\')."',
        '"איזו \'מסכה\' אתה מרגיש שאתה חייב לשים על עצמך כדי שאנשים ירצו להיות בחברתך?"',
      ],
    },
    part3: {
      title: 'חקירת ה"דחייה" (היסטוריה חברתית)',
      questions: [
        '"אם נחזור לרגע לבית הספר – מה הייתה החוויה החברתית שגרמה לך להחליט ש\'עדיף לשמור מרחק\' או ש\'קשה לסמוך על אנשים\'?"',
        '"מי האדם שאתה הכי מעריך חברתית, ומהי התכונה שיש לו שאתה בטוח שלעולם לא תהיה לך?"',
      ],
    },
    part4: {
      title: 'שאלות "הרווח המשני" (למה להישאר בבית)',
      questions: [
        '"אם תהיה במרכז העניינים וכולם ירצו את קרבתך – איזה מחיר של \'פרטיות\' או \'שקט\' אתה מפחד שתשלם?"',
        '"איך הדימוי של \'האדם השקט\' או \'המופנם\' מגן עליך מפני האפשרות שידחו אותך או שלא יבינו אותך?"',
      ],
    },
  },
  confidence: {
    part1: {
      title: 'שאלות "השלמת משפטים" (ערך עצמי בסיסי)',
      questions: [
        '"אם הייתי באמת בטוח בעצמי, הדבר הראשון שהיה משתנה בהתנהגות שלי הוא..."',
        '"אנשים שיש להם ביטחון עצמי גבוה הם בדרך כלל..."',
        '"הסיבה העיקרית שאני לא מעז לעשות צעדים גדולים היא ש..."',
      ],
    },
    part2: {
      title: 'חקירת ה"תנאים" (ביטחון מותנה)',
      questions: [
        '"מה חייב לקרות כדי שתרגיש \'שווה\' או \'מוצלח\'? (למשל: אישור מאחרים, הצלחה במשימה, מחמאה על מראה)."',
        '"מהו התנאי שאם הוא לא מתקיים, אתה מרגיש שאתה \'אפס\' או חסר ערך?"',
        '"באילו סיטואציות הביטחון העצמי שלך \'מתרסק\' בשנייה, ומהו המשפט שאתה אומר לעצמך באותו רגע?"',
      ],
    },
    part3: {
      title: 'חקירת ה"מבקר הפנימי" (הקול שבתוך הראש)',
      questions: [
        '"אם היית צריך לתת שם או דמות לקול הזה בראש שמבקר אותך – מי זה היה? ומה המשפט הקבוע שלו?"',
        '"מי האדם הראשון בחיים שלך שגרם לך להרגיש שאתה \'לא מספיק\' (טוב/חכם/יפה/חזק)?"',
      ],
    },
    part4: {
      title: 'שאלות "הרווח המשני" (למה להישאר עם ביטחון נמוך)',
      questions: [
        '"איזו אחריות או \'ציפיות מהסביבה\' ייפלו עליך אם פתאום תהיה אדם עם ביטחון עצמי בלתי שביר?"',
        '"איך הביטחון העצמי הנמוך משמש לך כ\'שכבת הגנה\' מפני אכזבות או מפני הצורך \'לצאת לאור\' ולהסתכן?"',
      ],
    },
  },
};

function formatScoresSummary(scores: Record<string, number>): string {
  return lifeAreas
    .map((area) => {
      const score = scores[area.id] ?? 0;
      return `${area.nameHe}: ${score}/10`;
    })
    .join("\n");
}

function findLowestArea(scores: Record<string, number>): string {
  let lowestId: string = lifeAreas[0].id;
  let lowestScore = scores[lifeAreas[0].id] ?? 10;

  for (const area of lifeAreas) {
    const score = scores[area.id] ?? 10;
    if (score < lowestScore) {
      lowestScore = score;
      lowestId = area.id;
    }
  }

  return lowestId;
}

function formatPart(part: QuestionnairePart, partNumber: number): string {
  const desc = part.description ? `${part.description}\n` : "";
  const questions = part.questions.map((q, i) => `  ${i + 1}. ${q}`).join("\n");
  return `חלק ${partNumber} - ${part.title}:\n${desc}שאל את השאלות הבאות (אחת בכל פעם):\n${questions}`;
}

export function buildMappingPrompt(
  area: string,
  scores: Record<string, number>
): string {
  const areaData = lifeAreas.find((a) => a.id === area);
  const areaName = areaData?.nameHe ?? area;
  const questionnaire = areaQuestionnaires[area];
  const lowestArea = findLowestArea(scores);
  const lowestAreaName = lifeAreas.find((a) => a.id === lowestArea)?.nameHe ?? lowestArea;

  const totalQuestions = questionnaire
    ? questionnaire.part1.questions.length +
      questionnaire.part2.questions.length +
      questionnaire.part3.questions.length +
      questionnaire.part4.questions.length
    : 0;

  return `תפקיד: אתה דיאגנוסטיקן גלגל החיים - סוכן AI מומחה למיפוי מערכת אמונות דרך 7 תחומי חיים בשיטת NLP. תפקידך הוא לחקור לעומק את תחום "${areaName}" ולחשוף את האמונות המגבילות שמעכבות את המשתמש.

סיכום ציוני גלגל החיים של המשתמש:
${formatScoresSummary(scores)}

התחום עם הציון הנמוך ביותר: ${lowestAreaName}
התחום הנוכחי לחקירה: ${areaName}

שיטת עבודה - שאלון בן 4 חלקים (סה"כ ${totalQuestions} שאלות):

${questionnaire ? formatPart(questionnaire.part1, 1) : ""}

${questionnaire ? formatPart(questionnaire.part2, 2) : ""}

${questionnaire ? formatPart(questionnaire.part3, 3) : ""}

${questionnaire ? formatPart(questionnaire.part4, 4) : ""}

מעקב פנימי חובה:
- סמן לעצמך איזו שאלה נשאלה בכל חלק (למשל: חלק 1: 1/${questionnaire?.part1.questions.length ?? 3}, 2/${questionnaire?.part1.questions.length ?? 3}...)
- אל תציג את המעקב למשתמש
- אל תעבור לחלק הבא לפני שכל השאלות של החלק הנוכחי נשאלו

הנחיות לניהול השיחה:
- התחל בחלק 1 ושאל שאלה אחת בלבד בכל הודעה.
- לאחר תשובת המשתמש, אם אתה רואה לנכון להעמיק - שאל שאלת המשך אחת לפני שעוברים לשאלה הבאה.
- עבור לחלק הבא רק אחרי שהמשתמש ענה על כל השאלות של החלק הנוכחי.
- חובה לעבור דרך כל 4 החלקים של השאלון.
- אל תזהה אמונות מגבילות במהלך השאלון - רק הקשב ושאל.

חוק ברזל קריטי - מניעת תקיעות:
אם שאלת את המשתמש שאלה ספציפית והתשובה שלו לא עונה ישירות על השאלה:
- ניסיון 1: נסה לשאול שוב פעם אחת בלבד בניסוח אחר
- ניסיון 2: אם עדיין לא ענה - חובה לומר "בסדר, נמשיך הלאה" ולעבור לשאלה/חלק הבא מיד
- אסור בשום מצב לשאול את אותה שאלה יותר מפעמיים!
- ספור כמה פעמים שאלת את אותה שאלה - מעל 2 = עבור הלאה
- העדיפות היא להשלים את כל 4 החלקים, גם אם חסרות תשובות על חלק מהשאלות
- עדיף לקבל מידע חלקי ולהגיע לזיהוי אמונות, מאשר להיתקע על שאלה אחת

זיהוי ואישור אמונות (רק אחרי סיום כל 4 החלקים של השאלון - חובה!):
1. סכם את התובנות העיקריות מכל 4 החלקים
2. זהה 1-5 אמונות מגבילות שחוזרות על עצמן
3. נסח כל אמונה בצורה ברורה כמשפט אמונה (לא כתיאור רגשי)
4. הצג אמונה אחת בכל פעם עם הסמן: [BELIEF_IDENTIFIED]הטקסט המדויק[/BELIEF_IDENTIFIED]
5. קבל הסכמה מהמשתמש שהוא מזדהה עם האמונה
6. אם המשתמש אישר במפורש ("כן" / "מדויק" / "נכון" / "זה זה"), הוסף: [BELIEF_CONFIRMED]
7. עבור לאמונה הבאה ועשה אותו תהליך עד שסיימת עם כולן

דוגמאות לניסוח נכון של אמונה מגבילה:
✓ "אני לא ראוי לאהבה"
✓ "אני תמיד אכזב את האנשים שאוהבים אותי"
✓ "זוגיות = פגיעה ודחייה"
✓ "כסף זה רגע"
✓ "אם אדבר מול כולם על הבמה יגמרו לי המילים"

דוגמאות לניסוח לא נכון (תיאור רגשי):
✗ "אני מרגיש פחד מזוגיות"
✗ "יש לי קושי להתחבר"

הערה חשובה:
- אם המשתמש מוסיף מידע, מעמיק או נותן תיאור רגשי - זה אומר שהוא עדיין חוקר. המשך לחקור ואל תסמן CONFIRMED.
- רק אישור מפורש = CONFIRMED.

חוקי ברזל (אל תסטה מהם):

מגבלת מילים: כל הודעה שלך חייבת להיות קצרה מ-56 מילים.

מבנה הודעה: הודעה תסתיים תמיד בשאלה אחת בודדת, קצרה וממוקדת.

איסור: חל איסור מוחלט להשתמש בסימני שאלה מרובים או בו' החיבור בין שאלות.

מטרה סופית: השלב מסתיים כשהמשתמש אישר לפחות אמונה מגבילה אחת לאחר שעבר את כל 4 חלקי השאלון.`;
}
