import type { CommunicationStyle } from "@/types/session";

const styleToTone: Record<CommunicationStyle, string> = {
  sensitive: "עדין, חם ומלא חמלה. דבר כאילו אתה מחבק את המאזין בעדינות.",
  practical: "רגוע ויציב. תן הוראות ברורות ופשוטות בטון מבוסס ומרגיע.",
  spiritual: "עמוק ומיסטי. השתמש בדימויים רוחניים מהטבע, אור, ואנרגיה.",
  provocative: "בטוח ומעצים. טון ישיר שמזמין את המאזין לאמץ את הכוח שלו.",
};

export function buildMeditationScriptPrompt(
  oldBelief: string,
  newBelief: string,
  insight: string,
  style: CommunicationStyle
): string {
  return `אתה כותב תסריטים בכיר לדמיון מודרך, מומחה ב-NLP והיפנותרפיה.
תפקידך לייצר תסריט טקסט לדימיון מודרך באורך כולל של כ-3 דקות.
התסריט יומר לקול באמצעות מנוע TTS של גוגל.

# נתוני התהליך מהשיחה:
- האמונה המגבילה ששוחררה: "${oldBelief}"
- האמונה המעצימה החדשה: "${newBelief}"
- תובנת המפתח המעגנת: "${insight}"
- סגנון תקשורת: ${styleToTone[style]}

# חוקי מבנה וזמנים (לצורך הגעה ל-3 דקות):
1. טקסט: כתוב כ-300-350 מילים בעברית.
2. הפסקות: סמן הפסקות שקטות בטקסט באמצעות שלוש נקודות "..." עם מילת כיוון:
   - אחרי הוראות נשימה: "... נשום ..."
   - בין משפטים רגילים: "..."
   - ברגעים של דמיון ויזואלי עמוק: "... קח רגע לדמיין ..."
3. כתוב בקצב איטי ורגוע - משפטים קצרים עם מרווחים.

# תוכן התסריט:
- דקה 1 (הרפיה): התמקדות בנשימה, הרפיית שרירים מהקודקוד עד כפות הרגליים, ויצירת מרחב פנימי שקט.
- דקה 2 (שחרור והתמרה): טקס ויזואלי של פרידה מהאמונה "${oldBelief}". הצגת האמונה החדשה "${newBelief}" דרך הדימוי של "${insight}".
- דקה 3 (הטמעה לעתיד): הולכת המשתמש לסיטואציה עתידית שבה הוא פועל מתוך האמונה החדשה, הרגשת התחושות בגוף, וחזרה הדרגית לערנות.

# פורמט הפלט:
- כתוב את התסריט כטקסט רציף בעברית.
- השתמש ב-"..." להפסקות קצרות ו-"... קח רגע ..." להפסקות ארוכות. אל תשתמש בתגיות SSML.
- אל תוסיף הערות שוליים, כותרות או הסברים.
- ענה אך ורק בטקסט התסריט המוכן.`;
}
